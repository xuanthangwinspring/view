<meta http-equiv="refresh" content="720">
<div class="container">
    <div id="viewDisplay" class="view-count">Đang tải...</div>
    <!--<div id="videoTitle" style="margin-bottom:10px; font-weight:bold;"></div>-->
    <div id="lastUpdate" class="last-update"></div>
</div>
<div id="video-container"></div>

<script>
const videoId = "HfyeVHIETJ4";
const videoDuration = 600;

// ===== Kiểm tra thiết bị =====
function isMobileDevice() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;

    // Kiểm tra điện thoại
    const isMobileUA = /android.*mobile|iphone|ipod|windows phone/i.test(userAgent);

    // Kiểm tra theo kích thước màn hình (bổ sung)
    const isSmallScreen = window.innerWidth <= 768;

    return isMobileUA || isSmallScreen;
}

// Nếu là điện thoại thì 20 iframe, còn lại 60
const iframeCount = isMobileDevice() ? 20 : 60;

const container = document.getElementById("video-container");

for (let i = 0; i < iframeCount; i++) {

    function createIframe() {
        const randomStart = Math.floor(Math.random() * (videoDuration - 5));

        const iframe = document.createElement("iframe");
        iframe.width = "560";
        iframe.height = "315";
        iframe.src = `https://www.youtube.com/embed/${videoId}?start=${randomStart}&rel=0&autoplay=1&mute=1`;
        iframe.title = "YouTube video player";
        iframe.frameBorder = "0";
        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        iframe.allowFullscreen = true;
        iframe.referrerPolicy = "strict-origin-when-cross-origin";

        return iframe;
    }

    let iframe = createIframe();
    container.appendChild(iframe);

    function scheduleReload() {
        const randomTime = Math.floor(Math.random() * (139000 - 123000 + 1)) + 123000;

        setTimeout(() => {
            container.removeChild(iframe);
            iframe = createIframe();
            container.appendChild(iframe);

            scheduleReload();
        }, randomTime);
    }

    scheduleReload();
}

    // ================= CẤU HÌNH TẠI ĐÂY =================
    const API_KEY = 'AIzaSyAU6exg6JfAsyzmlIJGpgTv_BFOf9u1x0g'; 
    const VIDEO_ID = 'HfyeVHIETJ4'; 
    // ====================================================

    const displayElement = document.getElementById('viewDisplay');
    // const titleElement = document.getElementById('videoTitle');
    const lastUpdateElement = document.getElementById('lastUpdate');

    async function fetchYouTubeViews() {
        try {
            // Gọi API lấy thông tin video
            const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${VIDEO_ID}&key=${API_KEY}`;
            
            const response = await fetch(url);
            const data = await response.json();

            if (data.items && data.items.length > 0) {
                const stats = data.items[0].statistics;
                const snippet = data.items[0].snippet;
                
                // Định dạng số (ví dụ: 1000000 -> 1.000.000)
                const formattedViews = parseInt(stats.viewCount).toLocaleString('vi-VN');
                
                // Hiển thị lên màn hình
                displayElement.innerText = formattedViews + '  lượt xem';
                // titleElement.innerText = snippet.title; // Tên video
                
                // Cập nhật thời gian
                const now = new Date();
                lastUpdateElement.innerText = `Cập nhật lúc: ${now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false })}`;
            } else {
                displayElement.innerText = "Lỗi";
                console.error("Không tìm thấy video hoặc sai ID/Key");
            }
        } catch (error) {
            console.error("Lỗi kết nối:", error);
            displayElement.innerText = "Lỗi Net";
        }
    }

    // Gọi lần đầu tiên ngay khi mở web
    fetchYouTubeViews();

    // Cài đặt tự động cập nhật mỗi 300 giây (300000 mili giây)
    setInterval(fetchYouTubeViews, 300000); 
</script>





